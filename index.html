import React, { useState, useEffect } from 'react';
import { Camera, Play, Pause, RotateCw, Info, BookOpen } from 'lucide-react';

const FunctionsARApp = () => {
  const [currentView, setCurrentView] = useState('menu');
  const [selectedFunctions, setSelectedFunctions] = useState([]);
  const [isSimulating, setIsSimulating] = useState(false);
  const [rotationSpeed, setRotationSpeed] = useState(1);
  const [showFormulas, setShowFormulas] = useState(true);
  const [compareMode, setCompareMode] = useState(false);

  const functions = [
    {
      id: 'sin',
      name: '–°–∏–Ω—É—Å',
      formula: 'f(x, y) = sin(‚àö(x¬≤ + y¬≤))',
      color: '#ff6b6b',
      description: '–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑ —Ä–∞–¥—ñ–∞–ª—å–Ω–æ—é —Å–∏–º–µ—Ç—Ä—ñ—î—é',
      domain: '‚Ñù¬≤',
      range: '[-1, 1]'
    },
    {
      id: 'paraboloid',
      name: '–ü–∞—Ä–∞–±–æ–ª–æ—ó–¥',
      formula: 'f(x, y) = x¬≤ + y¬≤',
      color: '#4ecdc4',
      description: '–ü–æ–≤–µ—Ä—Ö–Ω—è –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ä—è–¥–∫—É',
      domain: '‚Ñù¬≤',
      range: '[0, +‚àû)'
    },
    {
      id: 'saddle',
      name: '–°—ñ–¥–ª–æ',
      formula: 'f(x, y) = x¬≤ - y¬≤',
      color: '#45b7d1',
      description: '–ì—ñ–ø–µ—Ä–±–æ–ª—ñ—á–Ω–∏–π –ø–∞—Ä–∞–±–æ–ª–æ—ó–¥',
      domain: '‚Ñù¬≤',
      range: '‚Ñù'
    },
    {
      id: 'cone',
      name: '–ö–æ–Ω—É—Å',
      formula: 'f(x, y) = ‚àö(x¬≤ + y¬≤)',
      color: '#f9ca24',
      description: '–ö–æ–Ω—ñ—á–Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—è',
      domain: '‚Ñù¬≤',
      range: '[0, +‚àû)'
    },
    {
      id: 'waves',
      name: '–•–≤–∏–ª—ñ',
      formula: 'f(x, y) = sin(x) ¬∑ cos(y)',
      color: '#a29bfe',
      description: '–î–æ–±—É—Ç–æ–∫ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π',
      domain: '‚Ñù¬≤',
      range: '[-1, 1]'
    },
    {
      id: 'gaussian',
      name: '–ì–∞—É—Å—ñ–∞–Ω',
      formula: 'f(x, y) = e^(-(x¬≤ + y¬≤))',
      color: '#fd79a8',
      description: '–§—É–Ω–∫—Ü—ñ—è –ì–∞—É—Å–∞, –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª',
      domain: '‚Ñù¬≤',
      range: '(0, 1]'
    }
  ];

  const toggleFunction = (funcId) => {
    if (compareMode) {
      if (selectedFunctions.includes(funcId)) {
        setSelectedFunctions(selectedFunctions.filter(id => id !== funcId));
      } else if (selectedFunctions.length < 3) {
        setSelectedFunctions([...selectedFunctions, funcId]);
      }
    } else {
      setSelectedFunctions([funcId]);
    }
  };

  const MenuView = () => (
    <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-6">
      <div className="max-w-6xl mx-auto">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-white mb-2">üìê AR –ì—Ä–∞—Ñ—ñ–∫–∏ –§—É–Ω–∫—Ü—ñ–π</h1>
          <p className="text-purple-200">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –≤–∏–≤—á–µ–Ω–Ω—è —Ç—Ä–∏–≤–∏–º—ñ—Ä–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —É —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—ñ</p>
        </div>

        <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-2xl font-bold text-white">–û–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó</h2>
            <label className="flex items-center gap-2 text-white cursor-pointer">
              <input
                type="checkbox"
                checked={compareMode}
                onChange={(e) => {
                  setCompareMode(e.target.checked);
                  if (!e.target.checked && selectedFunctions.length > 1) {
                    setSelectedFunctions([selectedFunctions[0]]);
                  }
                }}
                className="w-5 h-5"
              />
              <span>–†–µ–∂–∏–º –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (–¥–æ 3-—Ö)</span>
            </label>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            {functions.map((func) => {
              const isSelected = selectedFunctions.includes(func.id);
              const canSelect = compareMode ? selectedFunctions.length < 3 || isSelected : true;

              return (
                <div
                  key={func.id}
                  onClick={() => canSelect && toggleFunction(func.id)}
                  className={`p-4 rounded-lg cursor-pointer transition-all transform hover:scale-105 ${
                    isSelected
                      ? 'bg-white/30 ring-4 ring-white'
                      : canSelect
                      ? 'bg-white/10 hover:bg-white/20'
                      : 'bg-gray-500/20 opacity-50 cursor-not-allowed'
                  }`}
                >
                  <div className="flex items-center gap-3 mb-2">
                    <div
                      className="w-6 h-6 rounded-full"
                      style={{ backgroundColor: func.color }}
                    />
                    <h3 className="text-xl font-bold text-white">{func.name}</h3>
                  </div>
                  <p className="text-lg font-mono text-purple-200 mb-2">{func.formula}</p>
                  <p className="text-sm text-purple-300">{func.description}</p>
                  <div className="mt-2 text-xs text-purple-200">
                    <div>–û–±–ª–∞—Å—Ç—å –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è: {func.domain}</div>
                    <div>–û–±–ª–∞—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å: {func.range}</div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        <div className="flex gap-4 justify-center">
          <button
            onClick={() => selectedFunctions.length > 0 && setCurrentView('ar')}
            disabled={selectedFunctions.length === 0}
            className={`px-8 py-4 rounded-xl font-bold text-lg transition-all flex items-center gap-2 ${
              selectedFunctions.length > 0
                ? 'bg-gradient-to-r from-green-400 to-blue-500 text-white hover:shadow-2xl transform hover:scale-105'
                : 'bg-gray-500 text-gray-300 cursor-not-allowed'
            }`}
          >
            <Camera className="w-6 h-6" />
            –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AR
          </button>
          
          <button
            onClick={() => setCurrentView('info')}
            className="px-8 py-4 bg-white/20 hover:bg-white/30 text-white rounded-xl font-bold text-lg transition-all flex items-center gap-2"
          >
            <Info className="w-6 h-6" />
            –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
          </button>
        </div>
      </div>
    </div>
  );

  const ARView = () => {
    const selectedFuncs = functions.filter(f => selectedFunctions.includes(f.id));

    return (
      <div className="min-h-screen bg-black text-white">
        <div className="absolute top-0 left-0 right-0 bg-gradient-to-b from-black/80 to-transparent p-4 z-10">
          <div className="flex justify-between items-center">
            <button
              onClick={() => setCurrentView('menu')}
              className="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg"
            >
              ‚Üê –ù–∞–∑–∞–¥
            </button>
            <div className="text-center">
              <h2 className="text-2xl font-bold">AR –°–∏–º—É–ª—è—Ü—ñ—è</h2>
              <p className="text-sm text-gray-300">
                {selectedFuncs.map(f => f.name).join(' + ')}
              </p>
            </div>
            <button
              onClick={() => setShowFormulas(!showFormulas)}
              className="px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded-lg"
            >
              {showFormulas ? 'üîΩ' : 'üîº'} –§–æ—Ä–º—É–ª–∏
            </button>
          </div>
        </div>

        <div className="relative h-screen flex items-center justify-center">
          <div className="absolute inset-0 bg-gradient-to-br from-gray-900 to-gray-800">
            <div className="grid grid-cols-10 grid-rows-10 h-full opacity-20">
              {[...Array(100)].map((_, i) => (
                <div key={i} className="border border-blue-500/30" />
              ))}
            </div>
          </div>

          <div className="relative w-full max-w-4xl aspect-video bg-gray-800/50 rounded-xl overflow-hidden">
            <div className="absolute top-4 left-4 bg-green-500 px-3 py-1 rounded-full text-sm flex items-center gap-2">
              <div className="w-2 h-2 bg-white rounded-full animate-pulse" />
              –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
            </div>

            <div className="flex items-center justify-center h-full gap-8 p-8">
              {selectedFuncs.map((func, idx) => (
                <div
                  key={func.id}
                  className="relative"
                  style={{
                    transform: isSimulating ? `rotateY(${Date.now() / (1000 / rotationSpeed)}deg)` : 'none',
                    transition: 'transform 0.1s linear'
                  }}
                >
                  <div className="text-center mb-4">
                    <div
                      className="w-48 h-48 mx-auto rounded-lg shadow-2xl"
                      style={{
                        background: `linear-gradient(135deg, ${func.color}dd, ${func.color}66)`,
                        border: `4px solid ${func.color}`,
                        position: 'relative',
                        overflow: 'hidden'
                      }}
                    >
                      <div className="absolute inset-0 opacity-30">
                        {[...Array(8)].map((_, i) => (
                          <div
                            key={i}
                            className="absolute w-full h-px bg-white"
                            style={{ top: `${(i + 1) * 12.5}%` }}
                          />
                        ))}
                        {[...Array(8)].map((_, i) => (
                          <div
                            key={i}
                            className="absolute h-full w-px bg-white"
                            style={{ left: `${(i + 1) * 12.5}%` }}
                          />
                        ))}
                      </div>
                      <div className="absolute inset-0 flex items-center justify-center">
                        <div className="text-6xl font-bold opacity-50">3D</div>
                      </div>
                    </div>
                  </div>

                  {showFormulas && (
                    <div className="bg-black/70 backdrop-blur-sm rounded-lg p-4 text-center">
                      <h3 className="text-xl font-bold mb-2" style={{ color: func.color }}>
                        {func.name}
                      </h3>
                      <p className="font-mono text-sm mb-2">{func.formula}</p>
                      <p className="text-xs text-gray-400">{func.description}</p>
                    </div>
                  )}
                </div>
              ))}
            </div>

            <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-blue-500/30 backdrop-blur-sm px-6 py-2 rounded-full text-sm">
              üìç –ú–∞—Ä–∫–µ—Ä: –ü–æ–≤–µ—Ä—Ö–Ω—è —Å—Ç–æ–ª—É
            </div>
          </div>
        </div>

        <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 z-10">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center justify-between gap-4">
              <button
                onClick={() => setIsSimulating(!isSimulating)}
                className={`flex-1 py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 ${
                  isSimulating
                    ? 'bg-red-500 hover:bg-red-600'
                    : 'bg-green-500 hover:bg-green-600'
                }`}
              >
                {isSimulating ? (
                  <>
                    <Pause className="w-5 h-5" /> –ó—É–ø–∏–Ω–∏—Ç–∏ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                  </>
                ) : (
                  <>
                    <Play className="w-5 h-5" /> –ü–æ—á–∞—Ç–∏ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
                  </>
                )}
              </button>

              <div className="flex-1 bg-white/10 backdrop-blur-sm rounded-xl p-3">
                <label className="text-sm mb-2 block">–®–≤–∏–¥–∫—ñ—Å—Ç—å –æ–±–µ—Ä—Ç–∞–Ω–Ω—è: {rotationSpeed}x</label>
                <input
                  type="range"
                  min="0.5"
                  max="3"
                  step="0.5"
                  value={rotationSpeed}
                  onChange={(e) => setRotationSpeed(parseFloat(e.target.value))}
                  className="w-full"
                />
              </div>

              <button
                onClick={() => setIsSimulating(false)}
                className="px-6 py-3 bg-purple-500 hover:bg-purple-600 rounded-xl font-bold flex items-center gap-2"
              >
                <RotateCw className="w-5 h-5" /> –°–∫–∏–Ω—É—Ç–∏
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  const InfoView = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 p-6">
      <div className="max-w-4xl mx-auto">
        <button
          onClick={() => setCurrentView('menu')}
          className="mb-6 px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-xl font-bold"
        >
          ‚Üê –ù–∞–∑–∞–¥ –¥–æ –º–µ–Ω—é
        </button>

        <div className="bg-white/10 backdrop-blur-md rounded-xl p-8 text-white">
          <div className="flex items-center gap-3 mb-6">
            <BookOpen className="w-8 h-8" />
            <h1 className="text-3xl font-bold">–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</h1>
          </div>

          <div className="space-y-6">
            <section>
              <h2 className="text-2xl font-bold mb-3 text-yellow-300">üì± –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å</h2>
              <ul className="space-y-2 ml-6 list-disc">
                <li>–¢—Ä–∏–≤–∏–º—ñ—Ä–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è –Ω–∞–¥ –º–∞—Ä–∫–µ—Ä–∞–º–∏ –Ω–∞ —Å—Ç–æ–ª—ñ</li>
                <li>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∑–º—ñ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è</li>
                <li>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö —Ñ—É–Ω–∫—Ü—ñ–π –æ–¥–Ω–æ—á–∞—Å–Ω–æ (–¥–æ 3-—Ö)</li>
                <li>–ö–∞—Ä—Ç–∫–∏ –∑ —Ñ–æ—Ä–º—É–ª–∞–º–∏ —Ç–∞ –æ–ø–∏—Å–∞–º–∏ —Ñ—É–Ω–∫—Ü—ñ–π</li>
                <li>–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ä—É–∫–æ–ø–∏—Å–Ω–∏—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-3 text-green-300">üéÆ –Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è</h2>
              <ol className="space-y-2 ml-6 list-decimal">
                <li>–û–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∞–±–æ –¥–µ–∫—ñ–ª—å–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é</li>
                <li>–£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ä–µ–∂–∏–º –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–ª—è –≤–∏–±–æ—Ä—É –¥–æ 3-—Ö —Ñ—É–Ω–∫—Ü—ñ–π</li>
                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ AR" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∫–∞–º–µ—Ä–∏</li>
                <li>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—é —Å—Ç–æ–ª—É</li>
                <li>–ì—Ä–∞—Ñ—ñ–∫–∏ –∑'—è–≤–ª—è—Ç—å—Å—è –Ω–∞–¥ –º–∞—Ä–∫–µ—Ä–æ–º</li>
                <li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è–º</li>
                <li>–ó–º—ñ–Ω—é–π—Ç–µ —à–≤–∏–¥–∫—ñ—Å—Ç—å –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –ø–æ–≤–∑—É–Ω–∫–æ–º</li>
              </ol>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-3 text-purple-300">‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</h2>
              <div className="grid md:grid-cols-2 gap-3">
                <div className="bg-white/10 p-3 rounded-lg">
                  <strong>MindAR:</strong> –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤
                </div>
                <div className="bg-white/10 p-3 rounded-lg">
                  <strong>Three.js:</strong> 3D —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                </div>
                <div className="bg-white/10 p-3 rounded-lg">
                  <strong>WebGL:</strong> –ì—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä—É—à—ñ–π
                </div>
                <div className="bg-white/10 p-3 rounded-lg">
                  <strong>React:</strong> –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                </div>
              </div>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-3 text-red-300">üìã –°–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–º–æ–≥–∏</h2>
              <ul className="space-y-2 ml-6 list-disc">
                <li>–ú–æ–±—ñ–ª—å–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é WebGL</li>
                <li>–°—É—á–∞—Å–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä (Chrome, Firefox, Safari)</li>
                <li>–ö–∞–º–µ—Ä–∞ –∑ –¥–æ–∑–≤–æ–ª–æ–º –º—ñ–Ω—ñ–º—É–º 720p</li>
                <li>–°—Ç–∞–±—ñ–ª—å–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º</li>
                <li>–†–æ–∑–¥—Ä—É–∫–æ–≤–∞–Ω–∏–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ —Å—Ç–æ–ª—É</li>
              </ul>
            </section>

            <section className="bg-yellow-500/20 p-4 rounded-lg">
              <h2 className="text-xl font-bold mb-2">üí° –ü–æ—Ä–∞–¥–∏</h2>
              <ul className="space-y-1 ml-6 list-disc text-sm">
                <li>–ó–∞–±–µ–∑–ø–µ—á—Ç–µ –≥–∞—Ä–Ω–µ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è</li>
                <li>–¢—Ä–∏–º–∞–π—Ç–µ –∫–∞–º–µ—Ä—É —Å—Ç–∞–±—ñ–ª—å–Ω–æ –Ω–∞–¥ –º–∞—Ä–∫–µ—Ä–æ–º</li>
                <li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∂–∏–º –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ä—ñ–∑–Ω–∏—Ü—ñ –º—ñ–∂ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏</li>
                <li>–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É–π—Ç–µ –∑ —Ä—ñ–∑–Ω–∏–º–∏ —à–≤–∏–¥–∫–æ—Å—Ç—è–º–∏ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è</li>
              </ul>
            </section>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div>
      {currentView === 'menu' && <MenuView />}
      {currentView === 'ar' && <ARView />}
      {currentView === 'info' && <InfoView />}
    </div>
  );
};

export default FunctionsARApp;
